#pragma once
#include <string>
#include <vector>

using namespace std;

class TwoFish
{
public:
	TwoFish() = default;
    ~TwoFish() = default;
	void encrypt(const vector<unsigned int>& src, vector<unsigned int>& dst) const;
	void decrypt(const vector<unsigned int>& src, vector<unsigned int>& ds) const;
	static string generateKey();
	void createKeys(const vector<unsigned int>& key);

private:
    unsigned int Me[4]; //вектор Ме (четные M)
    unsigned int Mo[4]; //вектор Mо (нечетные М)
    unsigned int S[4];  //вектор S. S-box (базис для алгоритма генерации ключей с использованием функции h) для использования в функции g
    unsigned int Key[40]; //расширенный ключ
};

static constexpr unsigned int p = 0x01010101; //ρ = 2^24 + 2^16 + 2^8 + 1.

#define ROL32(a, b)   (((a) << (b)) | ((a) >> (32 - (b)))) //сдвиг влево
#define ROR4(a, b)    ((((a) & 0xf) >> (b)) | (((a) & 0xf) << (4 - (b)))) //4-битный циклический сдвиг вправо
#define ROR32(a, b)   (((a) >> (b)) | ((a) << (32 - (b)))) //циклический сдвиг вправо 

static const unsigned char MDS[] =
{
        0x01, 0xEF, 0x5B, 0x5B,
        0x5B, 0xEF, 0xEF, 0x01,
        0xEF, 0x5B, 0x01, 0xEF,
        0xEF, 0x01, 0xEF, 0x5B
};

static const unsigned char RS[] =
{
        0x01, 0xA4, 0x55, 0x87, 0x5A, 0x58, 0xDB, 0x9E,
        0xA4, 0x56, 0x82, 0xF3, 0x1E, 0xC6, 0x68, 0xE5,
        0x02, 0xA1, 0xFC, 0xC1, 0x47, 0xAE, 0x3D, 0x19,
        0xA4, 0x55, 0x87, 0x5A, 0x58, 0xDB, 0x9E, 0x03
};

static const unsigned char q0_t0[] =
{
        0x8, 0x1, 0x7, 0xD, 0x6, 0xf, 0x3, 0x2, 0x0, 0xb, 0x5, 0x9, 0xe, 0xc, 0xa, 0x4
};

static const unsigned char q0_t1[] =
{
        0xe, 0xc, 0xb, 0x8, 0x1, 0x2, 0x3, 0x5, 0xf, 0x4, 0xa, 0x6, 0x7, 0x0, 0x9, 0xd
};

static const unsigned char q0_t2[] =
{
        0xb, 0xa, 0x5, 0xe, 0x6, 0xd, 0x9, 0x0, 0xc, 0x8, 0xf, 0x3, 0x2, 0x4, 0x7, 0x1
};

static const unsigned char q0_t3[] =
{
        0xd, 0x7, 0xf, 0x4, 0x1, 0x2, 0x6, 0xe, 0x9, 0xb, 0x3, 0x0, 0x8, 0x5, 0xc, 0xa
};

static const unsigned char q1_t0[] =
{
        0x2, 0x8, 0xb, 0xd, 0xf, 0x7, 0x6, 0xe, 0x3, 0x1, 0x9, 0x4, 0x0, 0xa, 0xc, 0x5
};

static const unsigned char q1_t1[] =
{
        0x1, 0xe, 0x2, 0xb, 0x4, 0xc, 0x3, 0x7, 0x6, 0xd, 0xa, 0x5, 0xf, 0x9, 0x0, 0x8
};

static const unsigned char q1_t2[] =
{
        0x4, 0xc, 0x7, 0x5, 0x1, 0x6, 0x9, 0xa, 0x0, 0xe, 0xd, 0x8, 0x2, 0xb, 0x3, 0xf
};

static const unsigned char q1_t3[] =
{
        0xb, 0x9, 0x5, 0x1, 0xc, 0x3, 0xd, 0xe, 0x6, 0x4, 0x7, 0xf, 0x2, 0x0, 0x8, 0xa
};
